/* zongheng PC 2018 Copyright (c) 2018 (zongheng FETEAM) lastUpdate: 2018-08-21 14:43:54*/
function getFormatDate(t,e){var a=t.getMonth()+1,s=(t.getDate(),t.getFullYear()+"."+n(a)+"."+n(t.getDate()));function n(t){return t<10&&(t="0"+t),t}return e&&(s+=" "+n(t.getHours())+":"+n(t.getMinutes())),s}function getDateDiff(t){var e=3600,a=24*e,s=7*a,n=30*a,i=((new Date).getTime()-t)/1e3;return result=i<60?"刚刚":i<e?parseInt(i/60)+"分钟前":i<a?parseInt(i/e)+"小时前":i<s?parseInt(i/a)+"天前":i<n?parseInt(i/s)+"周前":i<31104e3?parseInt(i/n)+"个月前":getFormatDate(new Date(t),!0),result}define(["jquery","widget"],function(l,u){var t=l("body").attr("forumid"),f=l("body").attr("threadid"),e=l(".Jfor-user").html(),p={options:{forumId:t,threadId:f},mearge:function(t){return this.options=l.extend(this.options,t),this.options}};p.userAct=function(t,e,a){var s=p.options;s.threadId=e,l.ajax({type:"get",url:"//forum.zongheng.com/api/thread/u/opt/"+t,data:s,cache:!1,async:!0,dataType:"json",error:function(){u.Alert("请求失败，请稍后再试！")},timeout:1e4,success:function(t){1==t.status?a&&a instanceof Function&&a(t.msg):"-101"==t.status||"202"==t.status?u.Toast({txt:t.msg,time:3e3,onHide:function(){UserUtil.login()}}):u.Toast(t.msg)}})},p.forumAct=function(t,e,a){var s=p.options;s.threadId=e,l.ajax({type:"get",url:"//forum.zongheng.com/api/thread/l/opt/"+t,data:s,cache:!1,async:!0,dataType:"json",error:function(){u.Alert("请求失败，请稍后再试！")},timeout:1e4,success:function(t){1!=t.status?"-101"==t.status||"202"==t.status?u.Toast({txt:t.msg,time:3e3,onHide:function(){UserUtil.login()}}):u.Toast(t.msg):a&&a instanceof Function&&a(t.msg)}})},p.isSd=function(t){return!!t.hasClass("sded")},p.deleteThrUser=function(t,e){u.Alert({con:"确定要删除此帖吗？",close:!0,width:360,height:201,cancel:!0,cb:{confirm:function(){return p.userAct("d",t,function(t){e&&e instanceof Function&&e(t)}),!1},cancel:function(){},close:function(){}}})},p.deleteThrForum=function(t,e){u.Alert({con:"确定要删除此帖吗？",close:!0,width:360,height:201,cancel:!0,cb:{confirm:function(){return p.forumAct("d",t,function(t){e&&e instanceof Function&&e(t)}),!1},cancel:function(){},close:function(){}}})};function m(d,c){l.ajax({type:"get",url:"//forum.zongheng.com/api/forums/details/speakForbidList",data:{forumId:t,pageNum:c,pageSize:6},cache:!1,async:!0,dataType:"json",error:function(){u.Alert("请求失败，请稍后再试！")},timeout:1e4,success:function(t){var e="";if(1==t.status){if(null==t.data.speakForbidList||null==t.data.speakForbidList.items||0==t.data.speakForbidList.items.length)return void l(".jy-page").hide();for(var a=t.data.speakForbidList.items,s=t.data.speakForbidList.pageCount,n=t.data.speakForbidList.firstPage,i=t.data.speakForbidList.hasNextPage,o=(t.data.speakForbidList.hasPreviousPage,t.data.speakForbidList.itemCount),r=0;r<a.length;r++)e+='<tr data-userid="'+a[r].userId+'"><td><span class="first">'+a[r].nickName+'</span></td><td><span class="reason" title="'+a[r].reason+'">'+a[r].reason+"</span></td><td>"+getFormatDate(new Date(a[r].createTime))+"</td><td>"+getFormatDate(new Date(a[r].expiresTime))+'</td><td><span class="act">解禁</span></td></tr>';d.find(".Jjycon").html(e),l(".jy-page").show().attr("data-page",c).html('<span class="prev"></span> 共<i class="pageCount">'+s+'</i>页<i class="allCount">'+o+'</i>条 <span class="next"></span>'),1==n?l(".jy-page .prev").hide():l(".jy-page .prev").show(),0==i?l(".jy-page .next").hide():l(".jy-page .next").show(),l(".jy-page .next").unbind().click(function(){c++,m(l("#Jjy-list"),c)}),l(".jy-page .prev").unbind().click(function(){c--,m(l("#Jjy-list"),c)})}else"-101"==t.status?u.Toast({txt:t.msg,time:3e3,onHide:function(){UserUtil.login()}}):u.Toast(t.msg)}})}var a,s,n=new u.Tab({id:"donateDialog",tab:["圈子禁言","禁言列表"],con:['<div id="Jjy-form">'+(a=e,s="",s+='<div class="jy-form-c clearfix"><span class="s-label">禁言用户：</span><span id="JjyNickName">'+a+"</span></div>",s+='<div class="jy-form-c clearfix"><span class="s-label">禁言时间：</span><select name="" id="JselectTime"><option value="1">1天</option><option value="3">3天</option><option value="7">7天</option></select></div>',s+='<div class="jy-form-c"><span class="s-label">禁言理由：</span><div class="s-textarea"  id="JjyTextarea"><textarea name=""  placeholder="圈主禁言"></textarea><div class="words" id="JjyWords"><i>0</i>/16</div></div></div>',s+='<div class="jy-form-c jy-tip"><em>!</em> 严禁使用任何html、javascript脚本或其他非法性字符</div>',s+='<div class="ui_widget_conbtn clearfix"> ',s+='<button class="confirm" id="Jjy_confirm" data-cb="confirm">确定</button> ',s+="</div>  ")+"</div>",'<div id="Jjy-list" class="jy-list"><table><thead><td><span class="first"> 用户昵称</span></td><td>禁言理由</td><td  width="12%">禁言时间</td><td width="12%">过期时间</td><td width="10%"><span>操作</span></td></thead></talbe><tbody class="Jjycon"></tbody></table><div class="jy-page"></div></div>'],close:!0,onTab:{1:function(){n.tabSwitch(1)},2:function(){m(l("#Jjy-list"),1)}},defaultTab:1,init:function(){l("#JjyTextarea").find(".words");l("#JjyTextarea").find("textarea").keyup(function(){var t=l(this).val().length;if(16<t){var e=l(this).val().substring(0,16);l(this).val(e)}else 0==t?l("#JjyWords").find("i").html(t).removeClass("cor"):l("#JjyWords").find("i").html(t).addClass("cor")}),l("#jy-list").click(function(){m(l("#Jjy-list"),1),n.close(),l("#testAlertDialog").click()})}});return p.getJybox=function(r,d,c){if(r.closest(".for-reset").removeClass("show"),r.hasClass("jyed"))return p.mearge({threadId:d.tId,userId:d.userId}),void p.forumAct("c",d.tId,function(t){u.Toast(t),c?r.removeClass("jyed").html("禁言"):l("#JthreadList li").each(function(){l(this).attr("data-userId")==d.userId&&l(this).find(".Jjy").removeClass("jyed").html("禁言")})});u.Alert({tit:"提示",con:"仅限于对作品/作者进行人身攻击或者发送OCR盗贴的读者禁言",tip:'<span class="text-left">由于禁言读者可能会造成读者的反感及投诉，希望能够保持平和的心态，慎重的进行读者禁言。</span>',close:!0,width:502,height:254,cancel:!0,cb:{confirm:function(){return l("#JjyNickName").text(d.tName),l("#JjyWords").find("i").html("0").removeClass("cor"),l("#JjyTextarea").find("textarea").val(""),n.open(),!1},cancel:function(){},close:function(){}}}),l("#Jjy_confirm").unbind().click(function(){var t=l("#JselectTime").val(),e=l("#JjyTextarea").find("textarea").val()||"圈主禁言";p.mearge({threadId:d.tId,exp:t,reason:e}),p.forumAct("f",d.tId,function(t){u.Toast(t),c?r.addClass("jyed").html("取消禁言"):l("#JthreadList li").each(function(){l(this).attr("data-userId")==d.userId&&l(this).find(".Jjy").addClass("jyed").html("取消禁言")}),n.close()})}),l("#Jjy-list").unbind().delegate(".act","click",function(){var e=l(this).closest("tr"),a=e.attr("data-userId"),t=l(".jy-page").find(".pageCount"),s=l(".jy-page").find(".allCount"),n=parseInt(t.text()),i=parseInt(s.text()),o=l(".jy-page").attr("data-page");p.mearge({threadId:f,userId:a}),p.forumAct("c",d.tId,function(t){u.Toast(t),c?r.removeClass("jyed").html("禁言"):(l("#JthreadList li").each(function(){l(this).attr("data-userId")==a&&l(this).find(".Jjy").removeClass("jyed").html("禁言")}),m(l("#Jjy-list"),(i-1)%6==0&&o==n?--o:o)),e.remove()})})},p});
